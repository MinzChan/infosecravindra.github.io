<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name=description content="How to use queues in Laravel"><meta name=keywords content="laravel, queues, '"><meta name=author content="Ravindra Sisodia"><meta property=og:title content="How to Use Queues in Laravel: Ravindra's Blog"><meta property=og:url content=https://infosecravindra.github.io/laravel/queues/2019/04/07/how-to-use-queues-in-laravel.html><meta property=og:site_name content="Ravindra's Blog"><meta property=og:type content=article><meta property=og:description content="How to use queues in Laravel"><meta property=article:author content="Ravindra Sisodia"><meta property=article:tag content=laravel><meta property=article:tag content=queues><meta property=article:published_time content=2019-04-22T23:33:28Z><meta property=og:image content=https://infosecravindra.github.io/assets/images/posts/laravel/how-to-use-queues-in-laravel.jpg><meta property=fb:app_id content=222225015360700><title>How to Use Queues in Laravel | Ravindra's Blog</title><link rel=icon href=https://infosecravindra.github.io/assets/images/logo.png><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.6.3/css/all.css integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin=anonymous><link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel=stylesheet><link href=/assets/css/screen.css rel=stylesheet><link href=/assets/css/main.css rel=stylesheet></head><body class=layout-post><nav class="navbar shadow-sm navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down"><div class="container pr-0"><a class=navbar-brand><img src=/assets/images/logo.png alt="Ravindra's Blog" width=30 height=30 class="d-inline-block align-top">Ravindra's Blog</a> <button class="navbar-toggler btn-link" data-toggle=collapse data-target=#navbarMediumish aria-controls=navbarMediumish aria-expanded=false aria-label="Toggle navigation"><span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMediumish><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/index.html><i class="fas fa-home"></i>&nbsp;&nbsp;Home</a></li><li class=nav-item><a class=nav-link href=/cheatsheets><i class="fas fa-book"></i>&nbsp;&nbsp;Cheatsheets</a></li><li class=nav-item><a class=nav-link href=/portfolio><i class="fas fa-user"></i>&nbsp;&nbsp;Projects</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><i class="far fa-address-card"></i>&nbsp;&nbsp;Contact</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a target=_blank class=nav-link href=mailto:rscipher001@gmail.com><i class="fas fa-envelope"></i>&nbsp;&nbsp;Mail</a><div class=dropdown-divider></div><a target=_blank class=nav-link href="https://www.github.com/InfoSecRavindra/"><i class="fab fa-github"></i>&nbsp;&nbsp;GitHub</a> <a target=_blank class=nav-link href="https://www.linkedin.com/in/InfoSecRavindra/"><i class="fab fa-linkedin"></i>&nbsp;&nbsp;LinkedIn</a> <a target=_blank class=nav-link href=https://www.youtube.com/c/EcoTechClubETC><i class="fab fa-youtube"></i>&nbsp;&nbsp;YouTube</a><div class=dropdown-divider></div><a target=_blank class=nav-link href=https://twitter.com/InfoSecRavindra><i class="fab fa-twitter"></i>&nbsp;&nbsp;Twitter</a></div></li></ul></div></div></nav><div class=site-content><div class=container><div class=mainheading><h1 class=sitetitle>Ravindra's Blog</h1><p class=lead>Let's Secure Everything</p></div><div class=main-content><div class=container><div class=row><div class="col-md-2 pl-0"><div class=share><p>Share</p><ul><li class="ml-1 mr-1"><a target=_blank href="https://facebook.com/sharer.php?u=https://infosecravindra.github.io/laravel/queues/2019/04/07/how-to-use-queues-in-laravel.html" onclick="window.open(this.href, 'facebook-share');return false;"><i class="fab fa-facebook-f"></i></a></li><li class="ml-1 mr-1"><a target=_blank href="https://twitter.com/intent/tweet?text=How+to+Use+Queues+in+Laravel&url=https://infosecravindra.github.io/laravel/queues/2019/04/07/how-to-use-queues-in-laravel.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a target=_blank href="https://www.linkedin.com/shareArticle?mini=true&url=https://infosecravindra.github.io/laravel/queues/2019/04/07/how-to-use-queues-in-laravel.html" onclick="window.open(this.href, 'linkedin-share');return false;"><i class="fab fa-linkedin-in"></i></a></li></ul><div class=sep></div><ul><li><a class="small smoothscroll" href=#disqus_thread></a></li></ul></div></div><div class="col-md-9 flex-first flex-md-unordered"><div class=mainheading><h1 class=posttitle>How to Use Queues in Laravel</h1></div><img class="featured-image img-fluid" src=https://infosecravindra.github.io/assets/images/posts/laravel/how-to-use-queues-in-laravel.jpg alt="How to Use Queues in Laravel"><div class=article-post><h1 id=introduction>Introduction</h1><p>Concept of queues is awesome but learning queues can be little bit confusing for some users because you’ve to do a lot of things to get things working like create jobs and choose drivers and start queue workers but don’t worry, when you will understand everything about queues life will be more easier. Let’s get started</p><h1 id=steps>Steps</h1><ul><li>Choose a driver</li><li>Create a table for queues</li><li>Create a mail and sent it without queue(for demonstration)</li><li>Create a job for sending mails in background</li><li>Start queue worker</li><li>Sending data to jobs</li></ul><h1 id=choose-a-driver>Choose a driver</h1><p>A driver defines how are we going to store and dispatch jobs in queues, don’t worry about it we are going to use database for this post, you are free to use any other driver like <code class=highlighter-rouge>redis</code> but don’t use <code class=highlighter-rouge>sync</code>, open your <code class=highlighter-rouge>.env</code> file and change <code class=highlighter-rouge>QUEUE_DRIVER</code> to <code class=highlighter-rouge>database</code></p><h1 id=create-a-table-for-queues>Create a table for queues</h1><p>We will store queues in database so we need a table, To create queues table open terminal and type <code class=highlighter-rouge>php artisan queue:table</code> and then <code class=highlighter-rouge>php artisan migrate</code>, it will create jobs table in the database.</p><h1 id=create-a-mail>Create a mail</h1><p>We are going to use mail example so let’s create a mail by running the following command</p><div class="language-bash highlighter-rouge"><div class=highlight><pre class=highlight><code>php artisan make:mail HelloMail <span class=nt>-m</span> mail.hello
</code></pre></div></div><p>and set mailtrap config in your <code class=highlighter-rouge>.env</code> file, to preview a mail without sending add this to your <code class=highlighter-rouge>web.php</code> and visit <code class=highlighter-rouge>/mail/hello</code></p><div class="language-php highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>use</span> <span class=nx>App\Mail\HelloMail</span><span class=p>;</span>

<span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>'mail/hello'</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
	<span class=k>return</span> <span class=p>(</span><span class=k>new</span> <span class=nx>HelloMail</span><span class=p>);</span>
<span class=p>});</span>
</code></pre></div></div><p>To send mail for testing add this lines to your web.php</p><div class="language-php highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>use</span> <span class=nx>App\Mail\HelloMail</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Support\Facades\Mail</span><span class=p>;</span>

<span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>'mail/hello/send'</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
	<span class=nx>Mail</span><span class=o>::</span><span class=na>to</span><span class=p>(</span><span class=s1>'johndoe@example.com'</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>send</span><span class=p>(</span><span class=k>new</span> <span class=nx>HelloMail</span><span class=p>);</span>
<span class=p>});</span>
</code></pre></div></div><p>If you will visit <code class=highlighter-rouge>/mail/hello/send</code> it will send an email synchronously so it will take some time, We are going to minimize that time by creating a job that handles time consuming tasks in background.</p><p>You can also open tinker and type <code class=highlighter-rouge>Mail::to('johndoe@example.com')-&gt;send(new HelloMail);</code> to send mail.</p><h1 id=create-a-job>Create a job</h1><p>To create a job run the following command in your terminal</p><div class="language-bash highlighter-rouge"><div class=highlight><pre class=highlight><code>php artisan make:job SendHelloEmail
</code></pre></div></div><p>now open <code class=highlighter-rouge>app/Jobs/SendHelloMail.php</code> and edit <code class=highlighter-rouge>handle()</code> method and copy paste the following code</p><div class="language-php highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>use</span> <span class=nx>App\Mail\HelloMail</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Support\Facades\Mail</span><span class=p>;</span>

<span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>()</span>
<span class=p>{</span>
	<span class=nx>Mail</span><span class=o>::</span><span class=na>to</span><span class=p>(</span><span class=s1>'johndoe@example.com'</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>send</span><span class=p>(</span><span class=k>new</span> <span class=nx>HelloMail</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></div><p>As you can see it is same line from <code class=highlighter-rouge>web.php</code> for sending email.</p><p>Now come back to your <code class=highlighter-rouge>web.php</code> and add these lines to create a new route that will send email by using job.</p><div class="language-php highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>use</span> <span class=nx>App\Jobs\SendHelloEmail</span><span class=p>;</span>

<span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>'mail/hello/send/job'</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
	<span class=nx>dispatch</span><span class=p>(</span><span class=k>new</span> <span class=nx>SendHelloEmail</span><span class=p>);</span>
<span class=p>});</span>
</code></pre></div></div><p>and visit to <code class=highlighter-rouge>mail/hello/send/job</code> and it will add a new job for sending email but it will not send email, you can verify this by going to jobs table in the database.</p><h1 id=start-queue-worker>Start queue worker</h1><p>To run the queue worker open terminal and type <code class=highlighter-rouge>php artisan queue:work</code> and it will start processing all pending jobs from jobs table, you can see output on the screen.</p><h1 id=sending-data-to-the-jobs>Sending data to the jobs</h1><p>In this example you can see that <code class=highlighter-rouge>johndoe@example.com</code> is hardcoded as email recipient but we need to pass it dynamically in real world apps, for that we are going to use Job constructor, I am not going to explain anything, following code snippet will do the job</p><div class="language-php highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=c1>// web.php</span>
<span class=k>use</span> <span class=nx>App\Jobs\SendHelloEmail</span><span class=p>;</span>

<span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>'mail/hello/send/job'</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
	<span class=nx>dispatch</span><span class=p>(</span><span class=k>new</span> <span class=nx>SendHelloEmail</span><span class=p>(</span><span class=s1>'real-email@example.com'</span><span class=p>));</span>
<span class=p>});</span>
</code></pre></div></div><div class="language-php highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=c1>// SendHelloEmail.php</span>

<span class=k>protected</span> <span class=nv>$email</span><span class=p>;</span>

<span class=k>public</span> <span class=k>function</span> <span class=nf>__construct</span><span class=p>(</span><span class=nv>$email</span><span class=p>)</span>
<span class=p>{</span>
	<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>email</span> <span class=o>=</span> <span class=nv>$email</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>()</span>
<span class=p>{</span>
	<span class=nx>Mail</span><span class=o>::</span><span class=na>to</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>email</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>send</span><span class=p>(</span><span class=k>new</span> <span class=nx>HelloMail</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></div></div><hr><p><span>Original:&nbsp;<time datetime=2019-04-07>07 Apr 2019</time></span> <span class="float-right clearfix">Updated:&nbsp;<time datetime=2019-04-22>Apr 22, 2019</time></span></p><hr><div class=after-post-tags><ul class=tags><li><a href=/archives/posts_archive.html#laravel class=post-tag>laravel</a></li><li><a href=/archives/posts_archive.html#queues class=post-tag>queues</a></li></ul></div><div class="row PageNavigation d-flex justify-content-between font-weight-bold"><a class="prev d-block col-md-6" href=https://infosecravindra.github.io/laravel/vue/pug/2019/03/19/how-to-use-pug-in-vue-template-with-laravel.html>&laquo; Pug in Vue template with Laravel</a> <a class="next d-block col-md-6 text-lg-right" href=https://infosecravindra.github.io/laravel/intervention/2019/04/08/how-to-resize-user-uploaded-images-in-laravel.html>How to Resize Images in Laravel &raquo;</a><div class=clearfix></div></div></div></div></div><div class=container><div id=comments class="row justify-content-center mb-5"><div class="col-md-9 col-offset-1"><div id=disqus_thread></div><script src=/assets/js/disqus.js></script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div></div></div><footer class=footer><div class=container><div class=row><div class="col-md-6 col-sm-6 text-center text-lg-left">Copyright © 2019 Ravindra Sisodia</div><div class="col-md-6 col-sm-6 text-center text-lg-right"><a target=_blank href=https://www.wowthemes.net>Mediumish Theme</a> by WowThemes.net</div></div></div></footer></div><script defer src=https://code.jquery.com/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script><script defer src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script><script defer src=/assets/js/ie10-viewport-bug-workaround.js></script><script defer src=/assets/js/mediumish.js></script><script defer id=dsq-count-scr src=//infosecravindra-github-io.disqus.com/count.js></script></body></html>