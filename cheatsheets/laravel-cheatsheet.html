<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><meta content=#fff name=theme-color><meta content="A Laravel Cheatsheet." name=description><meta content=" laravel,  '" name=keywords><meta content="Ravindra Sisodia" name=author><meta content="Laravel Cheatsheet: Ravindra's Blog" property=og:title><meta content=https://infosecravindra.github.io/cheatsheets/laravel-cheatsheet.html property=og:url><meta content="Ravindra's Blog" property=og:site_name><meta content=article property=og:type><meta content="A Laravel Cheatsheet." property=og:description><meta content="Ravindra Sisodia" property=article:author><meta content=laravel property=article:tag><meta content=2019-05-12T13:50:16Z property=article:published_time><meta content=https://infosecravindra.github.io/assets/images/cheatsheets/laravel-cheatsheet.webp property=og:image itemprop=image><meta content=222225015360700 property=fb:app_id><title>Laravel Cheatsheet | Ravindra's Blog</title><link href=/assets/manifest.json rel=manifest><link href=https://fonts.gstatic.com/ rel=preconnect><link href=https://infosecravindra.github.io/assets/images/logo.webp rel=icon><link href=/assets/css/bootstrap.css rel=stylesheet><link href=https://use.fontawesome.com/releases/v5.6.3/css/all.css rel=stylesheet crossorigin=anonymous integrity=sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/ ><link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel=stylesheet><link href=/assets/css/screen.css rel=stylesheet><link href=/assets/css/main.css rel=stylesheet></head><body class=layout-post><nav class="bg-white fixed-top mediumnavigation nav-down navbar navbar-expand-lg navbar-light shadow-sm"><div class="container pr-0"><a href=/ class=navbar-brand><img alt="Ravindra's Blog" class="align-top d-inline-block" src=/assets/images/logo.webp height=30 width=30>Ravindra's Blog</a><button aria-controls=navbarMediumish aria-expanded=false aria-label="Toggle navigation" class="btn-link navbar-toggler" data-target=#navbarMediumish data-toggle=collapse><span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMediumish><ul class="ml-auto navbar-nav"><li class=nav-item><a href=/index.html class=nav-link><i class="fas fa-home"></i>&nbsp;&nbsp;Home</a></li><li class=nav-item><a href=/cheatsheets class=nav-link><i class="fas fa-book"></i>&nbsp;&nbsp;Cheatsheets</a></li><li class=nav-item><a href=/portfolio class=nav-link><i class="fas fa-user"></i>&nbsp;&nbsp;Projects</a></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" aria-expanded=false aria-haspopup=true data-toggle=dropdown id=navbarDropdown role=button><i class="fa-address-card far"></i>&nbsp;&nbsp;Contact</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a href=mailto:rscipher001@gmail.com class=nav-link rel=noopener target=_blank><i class="fas fa-envelope"></i>&nbsp;&nbsp;Mail</a><div class=dropdown-divider></div><a href=https://www.github.com/InfoSecRavindra/ class=nav-link rel=noopener target=_blank><i class="fab fa-github"></i>&nbsp;&nbsp;GitHub</a><a href=https://www.linkedin.com/in/InfoSecRavindra/ class=nav-link rel=noopener target=_blank><i class="fab fa-linkedin"></i>&nbsp;&nbsp;LinkedIn</a><a href=https://www.youtube.com/c/EcoTechClubETC class=nav-link rel=noopener target=_blank><i class="fab fa-youtube"></i>&nbsp;&nbsp;YouTube</a><div class=dropdown-divider></div><a href=https://twitter.com/InfoSecRavindra class=nav-link rel=noopener target=_blank><i class="fab fa-twitter"></i>&nbsp;&nbsp;Twitter</a></div></li></ul></div></div></nav><div class=site-content><div class=container><div class=mainheading><h1 class=sitetitle>Ravindra's Blog</h1><p class=lead>Let's Secure Everything</p></div><div class=main-content><div class=container><div class=row><div class="col-md-2 pl-0"><div class=share><p>Share</p><ul><li class="ml-1 mr-1"><a href="https://facebook.com/sharer.php?u=https://infosecravindra.github.io/cheatsheets/laravel-cheatsheet.html" target=_blank onclick="window.open(this.href, 'facebook-share');return false;"><i class="fab fa-facebook-f"></i></a></li><li class="ml-1 mr-1"><a href="https://twitter.com/intent/tweet?text=Laravel+Cheatsheet&url=https://infosecravindra.github.io/cheatsheets/laravel-cheatsheet.html" target=_blank onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://infosecravindra.github.io/cheatsheets/laravel-cheatsheet.html" target=_blank onclick="window.open(this.href, 'linkedin-share');return false;"><i class="fab fa-linkedin-in"></i></a></li></ul><div class=sep></div><ul><li><a href=#disqus_thread class="small smoothscroll"></a></li></ul></div></div><div class="col-md-9 flex-first flex-md-unordered"><div class=mainheading><h1 class=posttitle>Laravel Cheatsheet</h1></div><img alt="Laravel Cheatsheet" class="featured-image img-fluid" src=https://infosecravindra.github.io/assets/images/cheatsheets/laravel-cheatsheet.webp><div class=article-post><p>Laravel cheatsheet.</p><h2 id=installation>Installation</h2><div class="highlighter-rouge language-bash"><div class=highlight><pre class=highlight><code><span class=nb>sudo </span>apt <span class=nb>install </span>mysql-server php-xml php-mysql php-bcmath php-mbstring
</code></pre></div></div><p>Remove<code class=highlighter-rouge>php-bcmath</code>if not going to use Telescope</p><h3 id=install-composer-and-set-path>Install composer and set path</h3><div class="highlighter-rouge language-bash"><div class=highlight><pre class=highlight><code>php <span class=nt>-r</span> <span class=s2>"copy('https://getcomposer.org/installer', 'composer-setup.php');"</span>
php <span class=nt>-r</span> <span class=s2>"if (hash_file('sha384', 'composer-setup.php') === '93b54496392c062774670ac18b134c3b3a95e5a5e5c8f1a9f115f203b75bf9a129d5daa8ba6a13e2cc8a1da0806388a8') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;"</span>
php composer-setup.php
php <span class=nt>-r</span> <span class=s2>"unlink('composer-setup.php');"</span>
</code></pre></div></div><p>Assuming composer is instaled in<code class=highlighter-rouge>/home/ravindra/Installation/Composer</code>then path values should be as follows.</p><div class="highlighter-rouge language-bash"><div class=highlight><pre class=highlight><code><span class=nv>PATH</span><span class=o>=</span><span class=nv>$PATH</span>:/home/ravindra/Installation/Composer
<span class=nv>PATH</span><span class=o>=</span><span class=nv>$PATH</span>:<span class=nv>$HOME</span>/.config/composer/vendor/bin
</code></pre></div></div><h3 id=install-laravel-installer>Install laravel installer</h3><div class="highlighter-rouge language-bash"><div class=highlight><pre class=highlight><code>composer global require laravel/installer
</code></pre></div></div><h2 id=model-factory>Model factory</h2><h3 id=generate-20-fake-users>Generate 20 fake users</h3><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=nv>$users</span> <span class=o>=</span> <span class=nx>factory</span><span class=p>(</span><span class=nx>App\User</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>create</span><span class=p>();</span>
</code></pre></div></div><h3 id=generate-10-fake-users-with-account_type-variable-set-to-admin>Generate 10 fake users with account_type variable set to admin</h3><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=nv>$user</span> <span class=o>=</span> <span class=nx>factory</span><span class=p>(</span><span class=nx>App\User</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>create</span><span class=p>([</span>
	<span class=s1>'account_type'</span> <span class=o>=&gt;</span> <span class=s1>'admin'</span>
<span class=p>]);</span>
</code></pre></div></div><h2 id=authorization>Authorization</h2><ul><li>Abort if user doesnâ€™t own project (In Controller)</li></ul><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=k>public</span> <span class=k>function</span> <span class=nf>show</span><span class=p>(</span><span class=nx>Project</span> <span class=nv>$project</span><span class=p>){</span>
	<span class=nx>abort_if</span> <span class=p>(</span><span class=nv>$project</span><span class=o>-&gt;</span><span class=na>owner_id</span> <span class=o>!=</span> <span class=nx>auth</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>id</span><span class=p>(),</span> <span class=mi>403</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></div><ul><li>Adding a method to user model (In Controller)</li></ul><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=k>public</span> <span class=k>function</span> <span class=nf>show</span><span class=p>(</span><span class=nx>Project</span> <span class=nv>$project</span><span class=p>){</span>
	<span class=nx>abort_if</span> <span class=p>(</span><span class=o>!</span> <span class=nx>auth</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>user</span><span class=o>-&gt;</span><span class=na>owns</span><span class=p>(</span><span class=nv>$project</span><span class=p>),</span> <span class=mi>403</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></div><p>or</p><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=k>public</span> <span class=k>function</span> <span class=nf>show</span><span class=p>(</span><span class=nx>Project</span> <span class=nv>$project</span><span class=p>){</span>
	<span class=nx>abort_unless</span> <span class=p>(</span><span class=nx>auth</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>user</span><span class=o>-&gt;</span><span class=na>owns</span><span class=p>(</span><span class=nv>$project</span><span class=p>),</span> <span class=mi>403</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></div><hr><h3 id=using-policy>Using Policy</h3><ul><li>Create a policy for project model (In Terminal)</li></ul><div class="highlighter-rouge language-bash"><div class=highlight><pre class=highlight><code>php artisan make:policy <span class=nt>-m</span> Project ProjectPolicy
</code></pre></div></div><p>or</p><div class=highlighter-rouge><div class=highlight><pre class=highlight><code>php artisan make:policy ProjectPolicy --model=Project
</code></pre></div></div><ul><li>Register a policy (In AuthServiceProvider)</li></ul><p>Open<code class=highlighter-rouge>app/Providers/AuthServiceProvider.php</code>and change<code class=highlighter-rouge>$policies</code>array according to your need</p><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=k>protected</span> <span class=nv>$policies</span> <span class=o>=</span> <span class=p>[</span>
	<span class=s1>'App\Project'</span> <span class=o>=&gt;</span> <span class=s1>'App\Policies\ProjectPolicy'</span><span class=p>,</span>
<span class=p>]</span>
</code></pre></div></div><ul><li>Abort if user doesnâ€™t own the project (In Policy)</li></ul><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=k>public</span> <span class=k>function</span> <span class=nf>view</span><span class=p>(</span><span class=nx>User</span> <span class=nv>$user</span><span class=p>,</span> <span class=nx>Project</span> <span class=nv>$project</span><span class=p>){</span>
	<span class=k>return</span> <span class=nx>project</span><span class=o>-&gt;</span><span class=na>owner_id</span> <span class=o>==</span> <span class=nv>$user</span><span class=o>-&gt;</span><span class=na>id</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></div><ul><li>Using without project (In Policy)</li></ul><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=k>public</span> <span class=k>function</span> <span class=nf>create</span><span class=p>(</span><span class=nx>User</span> <span class=nv>$user</span><span class=p>){</span>
	<span class=k>return</span> <span class=nv>$user</span><span class=o>-&gt;</span><span class=na>account_type</span> <span class=o>==</span> <span class=s1>'Admin'</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></div><ul><li>Using policy with project (In Controller)</li></ul><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=k>public</span> <span class=k>function</span> <span class=nf>show</span><span class=p>(</span><span class=nx>Project</span> <span class=nv>$project</span><span class=p>){</span>
	<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>authorize</span><span class=p>(</span><span class=s1>'view'</span><span class=p>,</span> <span class=nv>$project</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></div><ul><li>Using policy without project (In Controller)</li></ul><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=k>public</span> <span class=k>function</span> <span class=nf>create</span><span class=p>(){</span>
	<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>authorize</span><span class=p>(</span><span class=s1>'create'</span><span class=p>,</span> <span class=nx>Project</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></div><hr><h3 id=using-gate>Using Gate</h3><ul><li>Using gate (In Controller)</li></ul><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=k>public</span> <span class=k>function</span> <span class=nf>update</span><span class=p>(</span><span class=nx>Project</span> <span class=nv>$project</span><span class=p>){</span>
	<span class=nx>abort_if</span><span class=p>(</span><span class=nx>\Gate</span><span class=o>::</span><span class=na>denies</span><span class=p>(</span><span class=s1>'update'</span><span class=p>,</span> <span class=nv>$project</span><span class=p>),</span> <span class=mi>403</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></div><p>or</p><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=k>public</span> <span class=k>function</span> <span class=nf>update</span><span class=p>(</span><span class=nx>Project</span> <span class=nv>$project</span><span class=p>){</span>
	<span class=nx>abort_unless</span><span class=p>(</span><span class=nx>\Gate</span><span class=o>::</span><span class=na>allows</span><span class=p>(</span><span class=s1>'update'</span><span class=p>,</span> <span class=nv>$project</span><span class=p>),</span> <span class=mi>403</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></div><hr><h3 id=using-routes>Using Routes</h3><ul><li>Using middleware on a resource (In web.php)</li></ul><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=nx>Route</span><span class=o>::</span><span class=na>resource</span><span class=p>(</span><span class=s1>'project'</span><span class=p>,</span> <span class=s1>'ProjectController'</span><span class=p>)</span>
<span class=o>-&gt;</span><span class=na>middleware</span><span class=p>(</span><span class=s1>'can:update, project'</span><span class=p>);</span>
</code></pre></div></div><hr><h3 id=using-views>Using Views</h3><ul><li>Using blade files (random.blade.php)</li></ul><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=o>@</span><span class=nx>can</span><span class=p>(</span><span class=s1>'update'</span><span class=p>,</span> <span class=nv>$project</span><span class=p>)</span>
	<span class=nx>update</span> <span class=nx>related</span> <span class=nx>stuff</span>
<span class=o>@</span><span class=nx>endcan</span>
</code></pre></div></div><hr><h3 id=admin-override>Admin Override</h3><p>Open<code class=highlighter-rouge>app/Providers/AuthServiceProvider.php</code></p><p>\Illuminate\Auth</p><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=k>public</span> <span class=k>function</span> <span class=nf>boot</span><span class=p>(</span><span class=nx>Gate</span> <span class=nv>$gate</span><span class=p>){</span>
	<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>registerPolicies</span><span class=p>();</span>
	
	<span class=nv>$gate</span><span class=o>-&gt;</span><span class=na>before</span><span class=p>(</span><span class=k>function</span> <span class=p>(</span><span class=nv>$user</span><span class=p>){</span>
		<span class=k>return</span> <span class=nv>$user</span><span class=o>-&gt;</span><span class=na>isAdmin</span><span class=p>();</span>
	<span class=p>});</span>
<span class=p>}</span>
</code></pre></div></div><h3 id=setting-laravel-passport>Setting Laravel Passport</h3><ul><li>Install Passport via composer:<code class=highlighter-rouge>composer require laravel/passport</code></li><li>Migrate Database:<code class=highlighter-rouge>php artisan migrate</code></li><li>Install to generate keys:<code class=highlighter-rouge>php artisan passport:install</code>and save output somewhere or donâ€™t</li><li>Extend User Model by adding HasApiTokens Trait ```php use Laravel\Passport\HasApiTokens;</li></ul><p>class User extends Authenticatable { use HasApiTokens, Notifiable; }</p><div class=highlighter-rouge><div class=highlight><pre class=highlight><code>- Register routes in `AuthServiceProvider`
```php
use Laravel\Passport\Passport;
class AuthServiceProvider extends ServiceProvider
{

    public function boot()
    {
        $this-&gt;registerPolicies();
        Passport::routes();
    }
}
</code></pre></div></div><ul><li>Config auth driver:<code class=highlighter-rouge>config/auth.php</code>set driver and guard to passport<div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code>  <span class=s1>'guards'</span> <span class=o>=&gt;</span> <span class=p>[</span>
          <span class=s1>'web'</span> <span class=o>=&gt;</span> <span class=p>[</span>
                  <span class=s1>'driver'</span> <span class=o>=&gt;</span> <span class=s1>'session'</span><span class=p>,</span>
                  <span class=s1>'provider'</span> <span class=o>=&gt;</span> <span class=s1>'users'</span><span class=p>,</span>
          <span class=p>],</span>

          <span class=s1>'api'</span> <span class=o>=&gt;</span> <span class=p>[</span>
                  <span class=s1>'driver'</span> <span class=o>=&gt;</span> <span class=s1>'passport'</span><span class=p>,</span> <span class=c1>//here</span>
                  <span class=s1>'provider'</span> <span class=o>=&gt;</span> <span class=s1>'users'</span><span class=p>,</span>
          <span class=p>],</span>
  <span class=p>],</span>
</code></pre></div></div></li><li>Pull Vue Components:<code class=highlighter-rouge>php artisan vendor:publish --tag=passport-components</code></li><li>Register components: ```js Vue.component( â€˜passport-clientsâ€™, require(â€˜./components/passport/Clients.vueâ€™).default );</li></ul><p>Vue.component( â€˜passport-authorized-clientsâ€™, require(â€˜./components/passport/AuthorizedClients.vueâ€™).default );</p><p>Vue.component( â€˜passport-personal-access-tokensâ€™, require(â€˜./components/passport/PersonalAccessTokens.vueâ€™).default );</p><div class=highlighter-rouge><div class=highlight><pre class=highlight><code>
# Deploy
- `php artisan passport:keys`
- `php artisan passport:client`


### Tinker Tricks
## Truncate a table
```php
	User::truncate();
</code></pre></div></div></div><hr><p><span>Original:&nbsp;<time datetime=2019-01-01>01 Jan 2019</time></span><span class="clearfix float-right">Updated:&nbsp;<time datetime=2019-05-12>May 12, 2019</time></span></p><hr><div class=after-post-tags><ul class=tags><li><a href=/archives/cheatsheets_archive.html#laravel class=post-tag>laravel</a></li></ul></div><div class="row PageNavigation d-flex font-weight-bold justify-content-between"><a href=https://infosecravindra.github.io/cheatsheets/infosec/discovery_cheatsheet.html class="col-md-6 d-block prev">&laquo; Recon Cheatsheet</a><a href=https://infosecravindra.github.io/cheatsheets/laravel-snippet.html class="col-md-6 d-block next text-lg-right">Laravel Snippets &raquo;</a><div class=clearfix></div></div></div></div></div><div class=container><div class="row justify-content-center mb-5" id=comments><div class="col-md-9 col-offset-1"><div id=disqus_thread></div><script src=/assets/js/disqus.js></script><noscript>Please enable JavaScript to view the<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div></div></div><footer class=footer><div class=container><div class="row text-dark"><div class="col-md-6 col-sm-6 text-center text-lg-left">Copyright Â© 2019 Ravindra Sisodia</div><div class="col-md-6 col-sm-6 text-center text-lg-right"><a href=https://www.wowthemes.net class=text-dark rel=noopener target=_blank>Mediumish Theme</a>by WowThemes.net</div></div></div></footer></div><script src=https://code.jquery.com/jquery-3.3.1.min.js defer crossorigin=anonymous integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js defer crossorigin=anonymous integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM></script><script src=/assets/js/ie10-viewport-bug-workaround.js defer></script><script src=/assets/js/mediumish.js defer></script><script src=//infosecravindra-github-io.disqus.com/count.js defer id=dsq-count-scr></script></body></html>